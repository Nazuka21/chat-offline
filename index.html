<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat + Voice + Video Call</title>
  <style>
    :root {
      --bg: #f2f2f2;
      --fg: #000;
      --primary: #007bff;
      --card: #fff;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --fg: #f5f5f5;
      --primary: #2196f3;
      --card: #1e1e1e;
    }
    body {
      font-family: sans-serif; margin: 0; background: var(--bg); color: var(--fg);
    }
    header {
      background: var(--primary); color: white; padding: 10px; text-align: center;
      display: flex; justify-content: space-between; align-items: center;
    }
    .chat-box { padding: 10px; max-width: 600px; margin: auto; }
    #messages {
      height: 400px; overflow-y: scroll; background: var(--card); padding: 10px;
      border-radius: 8px; box-shadow: 0 0 4px #aaa; margin-bottom: 10px;
    }
    .msg { margin: 5px 0; }
    .msg.you { text-align: right; color: green; }
    .msg.other { text-align: left; color: var(--fg); }
    .bottom-bar {
      position: sticky; bottom: 0; background: var(--card); padding: 10px;
      border-top: 1px solid #ccc; display: flex; flex-wrap: wrap; gap: 5px;
    }
    input[type="text"] { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    button {
      padding: 8px 10px; border: none; border-radius: 5px; cursor: pointer;
      background: var(--primary); color: white;
    }
    button:hover { opacity: 0.9; }
    audio { width: 100%; margin-top: 5px; }
    #videoModal {
      display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;
    }
    #videoModalContent {
      background: #000; padding: 10px; border-radius: 10px; display: flex;
      flex-direction: column; align-items: center;
    }
    video { width: 100%; max-width: 500px; margin: 5px 0; border-radius: 10px; }
    .theme-toggle { background: none; border: none; color: white; font-size: 16px; cursor: pointer; }
  </style>
  <script>
  const user = localStorage.getItem("chatUser");
  const room = localStorage.getItem("chatRoom");
  if (!user || !room) {
    window.location.href = "login.html";  // Harus diarahkan ke login.html
  }
</script>

</head>
<body>
  <header>
    <h2 id="roomTitle">Room: </h2>
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  </header>
  <div class="chat-box">
    <div id="messages"></div>
    <div class="bottom-bar">
      <input type="text" id="textInput" placeholder="Tulis pesan..." />
      <button onclick="sendText()">Kirim</button>
      <button id="recBtn">üé§ Rekam</button>
      <button id="stopBtn" disabled>‚èπ Stop</button>
      <button onclick="openVideoCall()">üìπ Video Call</button>
    </div>
  </div>

  <!-- Modal Video Call -->
  <div id="videoModal">
    <div id="videoModalContent">
      <video id="localVideo" autoplay muted></video>
      <video id="remoteVideo" autoplay></video>
      <button onclick="closeVideoCall()">‚ùå Tutup</button>
    </div>
  </div>

<script>
// Theme toggle
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  html.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
  localStorage.setItem('theme', html.getAttribute('data-theme'));
}

(function restoreTheme() {
  const saved = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', saved);
})();
</script>

<!-- Chat, Video Call, Firebase scripts seperti sebelumnya tetap disisipkan -->
